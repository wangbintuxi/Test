import{_ as le,l as p,r as ae,k as ne,o as D,q as O,m as c,i as d,f as o,c as oe,bD as se,x as _,t as de,F as ce,w as ue,v as re,e as R,aR as ie,I as pe,bH as ve,bI as fe,C as he,cf as _e,D as me,bf as ke,d7 as ye,b3 as be}from"./index.eed59c8a.js";/* empty css              */import{g as ge,j as Ce}from"./role.df97e025.js";import{r as xe}from"./dept.3324d94f.js";import{_ as Se,F as Ke}from"./Form.ebe4e7a6.js";import"./isPlainObject.e1353217.js";const De=_("\u5C55\u5F00/\u6298\u53E0"),Ne=_("\u5168\u9009/\u5168\u4E0D\u9009"),Fe=_(" \u7236\u5B50\u8054\u52A8 "),Ee={class:"bottom-control"},Ie=_("\u53D6\u6D88"),Te=_("\u4FDD\u5B58"),we={__name:"DataScope",emits:["ok"],setup(Oe,{expose:U,emit:B}){const{proxy:P}=be(),N=p(null),f=p([]),s=p([]),v=p([]),g=p(!1),k=p([]),C=p(!0),y=p(!1),A=ae({formTitle:"",deptOptions:[],submitLoading:!1,form:{roleId:void 0,roleName:void 0,roleKey:void 0,deptIds:[],deptCheckStrictly:!0,remark:void 0},open:!1,dataScopeOptions:[{value:"1",label:"\u5168\u90E8\u6570\u636E\u6743\u9650"},{value:"2",label:"\u81EA\u5B9A\u4E49\u6570\u636E\u6743\u9650"},{value:"3",label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:"4",label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650"},{value:"5",label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}],defaultProps:{children:"children",title:"label",key:"id"}}),{formTitle:F,submitLoading:x,deptOptions:m,form:n,open:b,dataScopeOptions:L,defaultProps:V}=ne(A),E=()=>{I(),N.value.resetFields(),b.value=!1},I=()=>{n.value={roleId:void 0,roleName:void 0,roleKey:void 0,deptIds:[],deptCheckStrictly:!0,remark:void 0},C.value=!0,y.value=!1,k.value=[],f.value=[],g.value=!1,s.value=[],v.value=[],P.resetForm("formRef")},j=t=>xe(t).then(e=>(m.value=e.depts,K(e.depts),e)),S=(t,e)=>{let l;for(let u=0;u<e.length;u++){const r=e[u];r.children&&(r.children.some(i=>i.id===t)?l=r.id:S(t,r.children)&&(l=S(t,r.children)))}return l},q=()=>s.value.concat(v.value),H=t=>{I();const e=j(t.roleId);ge(t.roleId).then(l=>{n.value=l.data,b.value=!0,ie(()=>{e.then(i=>{s.value=i.checkedKeys,n.value.deptCheckStrictly&&T(m.value,[])});const u=m.value,r=k.value.map(i=>S(i.id,u));f.value=r}),F.value="\u4FEE\u6539\u89D2\u8272\u4FE1\u606F"})},T=(t,e)=>{if(!t||t.length===0)return[];t.forEach(l=>{const u=s.value.indexOf(l.id);u!==-1&&(e.forEach(h=>{v.value.indexOf(h)===-1&&v.value.push(h)}),e=[]);const r=v.value.indexOf(l.id),i=e.indexOf(l.id);return r===-1&&i===-1&&u===-1&&e.push(l.id),T(l.children,e)})},$=t=>{n.value.roleId!==void 0&&n.value.roleId!==null&&(n.value.deptIds=y.value?s.value:q(),x.value=!0,Ce(n.value).then(e=>{message.success("\u4FEE\u6539\u6210\u529F",3),b.value=!1,B("ok")}).finally(()=>{x.value=!1}))},z=t=>{console.error("\u6570\u636E\u9A8C\u8BC1\u5931\u8D25",t)},G=t=>{if(t.target.checked){const e=k.value;for(let l=0;l<e.length;l++)f.value.push(e[l].id)}else f.value=[]},J=t=>{f.value=t,g.value=!1},M=t=>{t.target.checked?(s.value=[],K(m.value)):(s.value=[],v.value=[])},K=t=>{if(!t||t.length===0)return[];t.forEach(e=>(s.value.push(e.id),k.value.push({id:e.id,label:e.label}),K(e.children)))},Q=t=>{n.value.deptCheckStrictly=t.target.checked},W=(t,e)=>{if(n.value.deptCheckStrictly)v.value=e.halfCheckedKeys,s.value=t;else{let l=[];s.value.checked&&(l=l.concat(s.value.checked)),s.value.halfChecked&&(l=l.concat(s.value.halfChecked)),s.value=l}};return U({handleDataScope:H}),(t,e)=>{const l=pe,u=Se,r=ve,i=fe,h=he,X=_e,w=me,Y=ke,Z=Ke,ee=ye;return D(),O(ee,{width:600,title:o(F),"label-col":4,"wrapper-col":14,visible:o(b),onClose:E},{default:c(()=>[d(Z,{"label-col":{span:5},"wrapper-col":{span:18},ref_key:"formRef",ref:N,model:o(n),onFinish:$,onFinishFailed:z},{default:c(()=>[d(u,{label:"\u89D2\u8272\u540D\u79F0",name:"roleName"},{default:c(()=>[d(l,{style:{width:"100%"},disabled:"",value:o(n).roleName,"onUpdate:value":e[0]||(e[0]=a=>o(n).roleName=a),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["value"])]),_:1}),d(u,{label:"\u6743\u9650\u5B57\u7B26",name:"roleKey"},{default:c(()=>[d(l,{style:{width:"100%"},disabled:"",value:o(n).roleKey,"onUpdate:value":e[1]||(e[1]=a=>o(n).roleKey=a),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["value"])]),_:1}),d(u,{label:"\u6743\u9650\u8303\u56F4",name:"dataScope"},{default:c(()=>[d(i,{value:o(n).dataScope,"onUpdate:value":e[2]||(e[2]=a=>o(n).dataScope=a),placeholder:"\u8BF7\u9009\u62E9"},{default:c(()=>[(D(!0),oe(ce,null,se(o(L),(a,te)=>(D(),O(r,{key:te,value:a.value},{default:c(()=>[_(de(a.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),ue(d(u,{label:"\u6570\u636E\u6743\u9650"},{default:c(()=>[R("div",null,[d(h,{checked:C.value,"onUpdate:checked":e[3]||(e[3]=a=>C.value=a),onChange:e[4]||(e[4]=a=>G(a))},{default:c(()=>[De]),_:1},8,["checked"]),d(h,{checked:y.value,"onUpdate:checked":e[5]||(e[5]=a=>y.value=a),onChange:e[6]||(e[6]=a=>M(a))},{default:c(()=>[Ne]),_:1},8,["checked"]),d(h,{checked:o(n).deptCheckStrictly,"onUpdate:checked":e[7]||(e[7]=a=>o(n).deptCheckStrictly=a),onChange:e[8]||(e[8]=a=>Q(a))},{default:c(()=>[Fe]),_:1},8,["checked"]),d(X,{class:"tree-border",checkedKeys:s.value,"onUpdate:checkedKeys":e[9]||(e[9]=a=>s.value=a),checkable:"","check-strictly":!o(n).deptCheckStrictly,"expanded-keys":f.value,"auto-expand-parent":g.value,"tree-data":o(m),fieldNames:o(V),onCheck:W,onExpand:J},null,8,["checkedKeys","check-strictly","expanded-keys","auto-expand-parent","tree-data","fieldNames"])])]),_:1},512),[[re,o(n).dataScope==2]]),R("div",Ee,[d(Y,null,{default:c(()=>[d(w,{type:"dashed",danger:"",onClick:E},{default:c(()=>[Ie]),_:1}),d(w,{type:"primary",loading:o(x),"html-type":"submitForm"},{default:c(()=>[Te]),_:1},8,["loading"])]),_:1})])]),_:1},8,["model"])]),_:1},8,["title","visible"])}}};var Ve=le(we,[["__scopeId","data-v-5775bed8"]]);export{Ve as default};
