import{G as U,l as p,r as V,cj as h,k as Q,b2 as G,bC as H,o as Y,q as A,m as s,i as o,f as g,bF as D,e as z,w as K,x as k,D as W,bf as X,bJ as Z,b3 as ee}from"./index.bde4a40f.js";import{_ as te}from"./index.b299fc45.js";import"./index.e162e362.js";/* empty css              */import{D as ae}from"./index.cfb0be37.js";import{C as ne}from"./index.ec64e5cc.js";import{b as oe}from"./shopManage.79e4811a.js";import{d as le}from"./financeManage.1dcacdea.js";import se from"./shopTree.733ce56a.js";import{_ as re,a as ie}from"./index.20aec7d3.js";import{_ as ce,F as ue}from"./Form.9957df10.js";import"./index.094c9c57.js";import"./RadioButton.41d4890b.js";import"./index.5d20d864.js";import"./Group.12a87c6f.js";import"./Search.26e235a2.js";import"./isPlainObject.46058b4b.js";import"./Password.f10fa33a.js";const me=k(" \u641C\u7D22 "),pe=k(" \u91CD\u7F6E "),de={class:"table-operations"},fe=k(" \u5BFC\u51FA "),_e=U({name:"month"}),Re=Object.assign(_e,{setup(he){const{proxy:N}=ee(),y=p("middle"),d=p(!1),f=p([]);let i=[];const v=p([]),O=V({dateRange:p(h().subtract(1,"month")),queryParams:{shopId:void 0,statisticalDate:void 0,status:null},columns:[{title:"\u9EA6\u8DA3\u65B0\u8BED",align:"center",children:[{title:"\u95E8\u5E97",dataIndex:"merchantName",key:"merchantName",align:"center"},{title:"\u7B80\u79F0",dataIndex:"aliasName",key:"aliasName",align:"center"},{title:"\u652F\u4ED8\u6E20\u9053",dataIndex:"transactionType",key:"transactionType",align:"center"}]},{title:h().subtract(1,"month").format("YYYY-MM"),align:"center",children:[{title:"\u6536\u94F6\u7B14\u6570",dataIndex:"cashierNumber",key:"cashierNumber",align:"center"},{title:"\u4EA4\u6613\u91D1\u989D\uFF08\u5143\uFF09",dataIndex:"transactionAmount",key:"transactionAmount",align:"center"},{title:"\u9000\u6B3E\u7B14\u6570",dataIndex:"refundNumber",key:"refundNumber",align:"center"},{title:"\u4F18\u60E0\u91D1\u989D\uFF08\u5143\uFF09",dataIndex:"preferentialAmount",key:"preferentialAmount",align:"center"},{title:"\u624B\u7EED\u8D39\uFF08\u5143\uFF09",dataIndex:"bankCharges",key:"bankCharges",align:"center"},{title:"\u7ED3\u7B97\u91D1\u989D\uFF08\u5143\uFF09",dataIndex:"settlementAmount",key:"settlementAmount",align:"center"}]}]}),{dateRange:c,queryParams:u,columns:r}=Q(O),q=()=>{c.value=h().subtract(1,"month"),N.resetForm("queryRef"),S()},S=()=>{r.value[1].title=c.value.format("YYYY-MM"),_()},_=()=>{d.value=!0,v.value=[],u.value.statisticalDate=h(c.value).format("YYYY-MM"),le(u.value).then(e=>{d.value=!1,i=[],C(e.data),i.length>0&&(R(),P())})};function C(e){if(e.length<1)return;let a=e[0],n=[],t=[];e.forEach(l=>{l.merchantName==a.merchantName?t.push(l):n.push(l)}),i.push(t),C(n)}function P(){let e=[];for(const a of i){let n={};for(const t of a)t.transactionType=="\u5C0F\u8BA1"?n=t:e.push(t);JSON.stringify(n)!="{}"&&e.push(n)}v.value=e}function R(){let e=i.map(function(n){return n.length}),a=[];for(const n in i){let t=0;for(let l=0;l<n;l++)t=t+e[l];a[n]=t}r.value[0].children[0].customCell=(n,t)=>{for(const l in a)if(t==a[l])return{rowSpan:e[l],colSpan:1};return t===a[a.length-1]+e[e.length-1]+0?{colSpan:2}:{rowSpan:0,colSpan:0}},r.value[0].children[1].customCell=(n,t)=>{for(const l in a)if(t==a[l])return{rowSpan:e[l],colSpan:1};return{rowSpan:0,colSpan:0}}}const M=e=>{u.value.shopId=e=="0-0"?void 0:e,_()},T=()=>{N.download("/maiquxinyu/monthlyPaper/export",{...u.value},`month_${new Date().getTime()}.xlsx`)};_();const w=()=>{oe().then(e=>{let a=e.data;Array.isArray(a)&&a.forEach(n=>{var t;n.shopName=`${n.shopName}(${(t=n.aliasName)!=null?t:""})`}),f.value=[{shopId:"0-0",shopName:"\u5168\u90E8",children:a}]})};w();function L(e){let a=JSON.parse(JSON.stringify(f.value[0].children));if(e==""||e==null||e==null)w();else{let n=[];a.forEach(t=>{t.shopName.indexOf(e)>-1&&n.push(t)}),f.value=[{shopId:"0-0",shopName:"\u5168\u90E8",children:n}]}}return(e,a)=>{const n=ne,t=re,l=ae,j=ce,b=G("c-icon"),x=W,B=X,I=ie,E=ue,F=Z,J=te,$=H("hasPermi");return Y(),A(I,{wrap:""},{default:s(()=>[o(t,{span:4},{default:s(()=>[o(n,{bordered:!1,class:"card",size:"small"},{default:s(()=>[o(se,{"shop-options":f.value,onSelect:M,onSelClick:L},null,8,["shop-options"])]),_:1})]),_:1}),o(t,{span:20},{default:s(()=>[o(n,{bordered:!1,class:"card card-search p-0",size:"small"},{default:s(()=>[o(E,{class:"search-form",model:g(u),ref:"queryRef","label-col":{span:8},"wrapper-col":{span:16}},{default:s(()=>[o(I,{gutter:24},{default:s(()=>[o(t,{md:12,sm:24},{default:s(()=>[o(j,{label:"\u4EA4\u6613\u65F6\u95F4"},{default:s(()=>[o(l,{value:g(c),"onUpdate:value":a[0]||(a[0]=m=>D(c)?c.value=m:null),picker:"month"},null,8,["value"])]),_:1})]),_:1}),o(t,{md:12,sm:24},{default:s(()=>[z("span",null,[o(B,null,{default:s(()=>[o(x,{type:"primary",onClick:S},{default:s(()=>[o(b,{type:"SearchOutlined"}),me]),_:1}),o(x,{onClick:q},{default:s(()=>[o(b,{type:"SyncOutlined"}),pe]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(n,{bordered:!1,class:"card",size:"small"},{default:s(()=>[z("div",de,[K((Y(),A(x,{class:"is-plain",type:"warn",onClick:T},{default:s(()=>[o(b,{type:"CloudDownloadOutlined"}),fe]),_:1})),[[$,["maiquxinyu:monthlyPaper:export"]]]),o(F,{class:"float-right",columns:g(r),"onUpdate:columns":a[1]||(a[1]=m=>D(r)?r.value=m:null),tableSize:y.value,"onUpdate:tableSize":a[2]||(a[2]=m=>y.value=m),"refresh-loading":d.value,onRefresh:_},null,8,["columns","tableSize","refresh-loading"])]),o(J,{loading:d.value,size:y.value,columns:g(r),"data-source":v.value,pagination:!1,bordered:""},null,8,["loading","size","columns","data-source"])]),_:1})]),_:1})]),_:1})}}});export{Re as default};
