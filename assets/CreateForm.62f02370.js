import{l as _,r as ne,k as oe,b2 as se,o as re,q as ue,m as s,i as a,f as o,e as K,x as p,aR as ce,be as M,I as de,bu as ie,C as me,cf as _e,E as pe,D as fe,bf as ve,d7 as he,b3 as ke}from"./index.eed59c8a.js";/* empty css              */import{_ as ye}from"./index.dc2e029d.js";import{_ as ge}from"./index.4efc3d67.js";import{g as Ce,h as be,i as xe}from"./role.df97e025.js";import{t as Se,r as Ke}from"./menu.8b062746.js";import{_ as Ne,F as Fe}from"./Form.ebe4e7a6.js";import"./isPlainObject.e1353217.js";const Ie=p("\u63A7\u5236\u5668\u4E2D\u5B9A\u4E49\u7684\u6743\u9650\u5B57\u7B26\uFF0C\u5982\uFF1A@PreAuthorize(`@ss.hasRole('admin')`)"),Re=K("span",{class:"pl-4"},"\u6743\u9650\u5B57\u7B26",-1),Ee={class:"mt-1"},Te=p("\u5C55\u5F00/\u6298\u53E0"),we=p("\u5168\u9009/\u5168\u4E0D\u9009"),Me=p("\u7236\u5B50\u8054\u52A8"),Ue={class:"bottom-control"},Ae=p("\u53D6\u6D88"),Oe=p("\u4FDD\u5B58"),Qe={__name:"CreateForm",props:{sys_normal_disable:{type:Array,required:!0}},emits:["ok"],setup(U,{expose:A,emit:N}){const{proxy:O}=ke(),F=_(),y=_(1),f=_([]),u=_([]),d=_([]),g=_(!1),q=ne({formTitle:"",menuOptions:[],submitLoading:!1,form:{roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},open:!1,rules:{roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleKey:[{required:!0,message:"\u6743\u9650\u5B57\u7B26\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleSort:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},defaultProps:{children:"children",title:"label",key:"id"}}),{formTitle:C,submitLoading:h,menuOptions:i,form:l,open:m,rules:P,defaultProps:V}=oe(q),I=()=>{F.value.resetFields(),m.value=!1,b()},b=()=>{y.value=1,l.value={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},f.value=[],g.value=!1,u.value=[],d.value=[],O.resetForm("formRef")},$=()=>{Se().then(t=>{i.value=t.data})},B=t=>Ke(t).then(e=>(i.value=e.menus,e)),R=()=>u.value.concat(d.value),L=t=>{b(),y.value=1,$(),m.value=!0,C.value="\u6DFB\u52A0\u89D2\u8272\u4FE1\u606F"},z=t=>{b(),y.value=2;const e=t.roleId,n=B(e);Ce(e).then(c=>{l.value=c.data,l.value.roleSort=Number(l.value.roleSort),m.value=!0,ce(()=>{n.then(v=>{u.value=v.checkedKeys,l.value.menuCheckStrictly&&E(i.value,[])})}),C.value="\u4FEE\u6539\u89D2\u8272\u4FE1\u606F"})},E=(t,e)=>{if(!t||t.length===0)return[];t.forEach(n=>{const c=u.value.indexOf(n.id);c!==-1&&(e.forEach(k=>{d.value.indexOf(k)===-1&&d.value.push(k)}),e=[]);const v=d.value.indexOf(n.id),x=e.indexOf(n.id);return v===-1&&x===-1&&c===-1&&e.push(n.id),E(n.children,e)})},D=t=>{h.value=!0,l.value.roleId!==void 0&&l.value.roleId!==null?(l.value.menuIds=R(),be(l.value).then(e=>{M.success("\u4FEE\u6539\u6210\u529F",3),m.value=!1,N("ok")}).finally(()=>{h.value=!1})):(l.value.menuIds=R(),xe(l.value).then(e=>{M.success("\u65B0\u589E\u6210\u529F",3),m.value=!1,N("ok")}).finally(()=>{h.value=!1}))},Q=t=>{console.error("\u6570\u636E\u9A8C\u8BC1\u5931\u8D25",t)},j=(...t)=>{},G=t=>{if(t.target.checked){const e=i.value;for(let n=0;n<e.length;n++)f.value.push(e[n].id)}else f.value=[]},H=t=>{t.target.checked?T(i.value):(u.value=[],d.value=[])},J=t=>{f.value=t,g.value=!1},T=t=>{if(!t||t.length===0)return[];t.forEach(e=>(u.value.push(e.id),T(e.children)))},W=t=>{l.value.menuCheckStrictly=!l.value.menuCheckStrictly},X=(t,e)=>{if(l.value.menuCheckStrictly)d.value=e.halfCheckedKeys,u.value=t;else{let n=[];u.value.checked&&(n=n.concat(u.value.checked)),u.value.halfChecked&&(n=n.concat(u.value.halfChecked)),u.value=n}};return A({handleAdd:L,handleUpdate:z}),(t,e)=>{const n=de,c=Ne,v=se("c-icon"),x=ie,k=ge,Y=ye,S=me,Z=_e,ee=pe,w=fe,te=ve,le=Fe,ae=he;return re(),ue(ae,{width:600,title:o(C),"label-col":4,"wrapper-col":14,visible:o(m),onClose:I},{default:s(()=>[a(le,{"label-col":{span:5},"wrapper-col":{span:18},ref_key:"formRef",ref:F,model:o(l),rules:o(P),onFinish:D,onValidate:j,onFinishFailed:Q},{default:s(()=>[a(c,{label:"\u89D2\u8272\u540D\u79F0",name:"roleName"},{default:s(()=>[a(n,{value:o(l).roleName,"onUpdate:value":e[0]||(e[0]=r=>o(l).roleName=r),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["value"])]),_:1}),a(c,{name:"roleKey"},{label:s(()=>[a(x,{placement:"top"},{title:s(()=>[Ie]),default:s(()=>[a(v,{type:"QuestionCircleFilled"})]),_:1}),Re]),default:s(()=>[a(n,{value:o(l).roleKey,"onUpdate:value":e[1]||(e[1]=r=>o(l).roleKey=r),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["value"])]),_:1}),a(c,{label:"\u89D2\u8272\u987A\u5E8F",name:"roleSort"},{default:s(()=>[a(k,{style:{width:"100%"},value:o(l).roleSort,"onUpdate:value":e[2]||(e[2]=r=>o(l).roleSort=r),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u987A\u5E8F"},null,8,["value"])]),_:1}),a(c,{label:"\u89D2\u8272\u72B6\u6001",name:"status"},{default:s(()=>[a(Y,{value:o(l).status,"onUpdate:value":e[3]||(e[3]=r=>o(l).status=r),options:U.sys_normal_disable},null,8,["value","options"])]),_:1}),a(c,{label:"\u83DC\u5355\u6743\u9650"},{default:s(()=>[K("div",Ee,[a(S,{onChange:e[4]||(e[4]=r=>G(r))},{default:s(()=>[Te]),_:1}),a(S,{onChange:e[5]||(e[5]=r=>H(r))},{default:s(()=>[we]),_:1}),a(S,{checked:o(l).menuCheckStrictly,onChange:e[6]||(e[6]=r=>W())},{default:s(()=>[Me]),_:1},8,["checked"]),a(Z,{class:"tree-border",checkedKeys:u.value,"onUpdate:checkedKeys":e[7]||(e[7]=r=>u.value=r),checkable:"","check-strictly":!o(l).menuCheckStrictly,"expanded-keys":f.value,"auto-expand-parent":g.value,"tree-data":o(i),fieldNames:o(V),onCheck:X,onExpand:J},null,8,["checkedKeys","check-strictly","expanded-keys","auto-expand-parent","tree-data","fieldNames"])])]),_:1}),a(c,{label:"\u5907\u6CE8",name:"remark"},{default:s(()=>[a(ee,{value:o(l).remark,"onUpdate:value":e[8]||(e[8]=r=>o(l).remark=r),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8\u4FE1\u606F",autoSize:{minRows:4,maxRows:6},"allow-clear":""},null,8,["value"])]),_:1}),K("div",Ue,[a(te,null,{default:s(()=>[a(w,{type:"dashed",danger:"",onClick:I},{default:s(()=>[Ae]),_:1}),a(w,{type:"primary",loading:o(h),"html-type":"submitForm"},{default:s(()=>[Oe]),_:1},8,["loading"])]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["title","visible"])}}};export{Qe as default};
