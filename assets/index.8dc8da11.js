import{G as _e,l as v,r as ve,cj as b,k as ge,b2 as ye,bC as be,o as V,q as $,m as u,i,f as L,bF as G,e as U,bd as xe,w as Ne,x as F,D as Se,bf as we,bJ as Ce,b3 as De}from"./index.bde4a40f.js";import{_ as ke}from"./index.b299fc45.js";import"./index.e162e362.js";/* empty css              */import{R as Te}from"./index.cfb0be37.js";import{C as Oe}from"./index.ec64e5cc.js";import{b as Me}from"./shopManage.79e4811a.js";import{c as Le}from"./financeManage.1dcacdea.js";import Ee from"./shopTree.733ce56a.js";import{_ as Ie,a as Re}from"./index.20aec7d3.js";import{_ as Fe,F as ze}from"./Form.9957df10.js";import"./index.094c9c57.js";import"./RadioButton.41d4890b.js";import"./index.5d20d864.js";import"./Group.12a87c6f.js";import"./Search.26e235a2.js";import"./isPlainObject.46058b4b.js";import"./Password.f10fa33a.js";function z(e,o){return o===void 0&&(o=15),+parseFloat(Number(e).toPrecision(o))}function h(e){var o=e.toString().split(/[eE]/),s=(o[0].split(".")[1]||"").length-+(o[1]||0);return s>0?s:0}function k(e){if(e.toString().indexOf("e")===-1)return Number(e.toString().replace(".",""));var o=h(e);return o>0?z(Number(e)*Math.pow(10,o)):Number(e)}function R(e){X&&(e>Number.MAX_SAFE_INTEGER||e<Number.MIN_SAFE_INTEGER)&&console.warn(e+" is beyond boundary when transfer to integer, the results may not be accurate")}function I(e){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var d=o[0],g=o.slice(1);return g.reduce(function(_,C){return e(_,C)},d)}}var x=I(function(e,o){var s=k(e),d=k(o),g=h(e)+h(o),_=s*d;return R(_),_/Math.pow(10,g)}),Ae=I(function(e,o){var s=Math.pow(10,Math.max(h(e),h(o)));return(x(e,s)+x(o,s))/s}),Be=I(function(e,o){var s=Math.pow(10,Math.max(h(e),h(o)));return(x(e,s)-x(o,s))/s}),H=I(function(e,o){var s=k(e),d=k(o);return R(s),R(d),x(s/d,z(Math.pow(10,h(o)-h(e))))});function Je(e,o){var s=Math.pow(10,o),d=H(Math.round(Math.abs(x(e,s))),s);return e<0&&d!==0&&(d=x(d,-1)),d}var X=!0;function Ye(e){e===void 0&&(e=!0),X=e}var E={strip:z,plus:Ae,minus:Be,times:x,divide:H,round:Je,digitLength:h,float2Fixed:k,enableBoundaryChecking:Ye},Q={add(e,o){return E.plus(e,o)},multiply(e,o){return E.times(e,o)},subtract(e,o){return E.minus(e,o)},divide(e,o){return E.divide(e,o)}};const je=F(" \u67E5\u8BE2 "),qe=F(" \u91CD\u7F6E "),Pe={class:"table-operations"},Ve=F(" \u5BFC\u51FA "),$e=_e({name:"day"}),ut=Object.assign($e,{setup(e){const{proxy:o}=De(),s=v("middle"),d=v(!1),g=v(!1),_=v([]);let C=[],T=[],O=[],N=[];const A=v(1),y=v(),K=v(),B=v(),W=a=>{if(!y.value||y.value.length===0)return!1;const n=y.value[0]&&a.diff(y.value[0],"days")>30;return y.value[1]&&y.value[1].diff(a,"days")>30||n},J=v([]),Z=ve({dateRange:[b().subtract(7,"day"),b().subtract(1,"day")],queryParams:{startDate:void 0,endDate:void 0,shopId:void 0},columns:[{title:"\u9EA6\u8DA3\u65B0\u8BED",align:"center",width:200,fixed:"left",children:[{title:"\u95E8\u5E97",dataIndex:"merchantName",key:"merchantName",align:"center",width:100,fixed:"left"},{title:"\u7B80\u79F0",dataIndex:"aliasName",key:"aliasName",align:"center",width:100,fixed:"left"},{title:"\u652F\u4ED8\u6E20\u9053",dataIndex:"transactionType",key:"transactionType",align:"center",width:100,fixed:"left"}]}]}),ee=[{title:"\u5C0F\u8BA1",align:"center",children:[{title:"\u5B9E\u9645\u4EA4\u6613\u91D1\u989D",dataIndex:"xj",key:"xj",align:"center",width:100,fixed:"right"}]},{title:"\u65E5\u5747",align:"center",children:[{title:"\u5B9E\u9645\u4EA4\u6613\u91D1\u989D",dataIndex:"rj",key:"rj",align:"center",width:100,fixed:"right"}]}],{dateRange:S,queryParams:w,columns:m}=ge(Z),te=a=>{a?(y.value=[],B.value=[]):B.value=void 0},ae=a=>{K.value=a},ne=a=>{y.value=a},re=()=>{S.value=[b().subtract(7,"day"),b().subtract(1,"day")],o.resetForm("queryRef"),Y()},Y=()=>{M()},M=()=>{g.value=!0,w.value.startDate=b(S.value[0]).format("YYYY-MM-DD"),w.value.endDate=b(S.value[1]).format("YYYY-MM-DD"),Le(w.value).then(a=>{C=JSON.parse(JSON.stringify(a.data));let n=a.data;N=[],se(n),T=[],j(n),g.value=!1,oe()})};function oe(){var n;let a=[];for(const r of T){let t={};for(const l of r)if(l.transactionType=="\u5C0F\u8BA1")t={merchantName:l.merchantName,transactionType:l.transactionType};else{let c={merchantName:l.merchantName,aliasName:l.aliasName,transactionType:l.transactionType};a.push(c)}JSON.stringify(t)!="{}"&&a.push(t)}for(let r=0;r<C.length;r++){const t=C[r];for(const l of a)l.merchantName==t.merchantName&&l.transactionType==t.transactionType&&(l[t.statisticalDate]=t.transactionAmount)}for(const r of a){r.xj=0,r.rj=0;for(let t=0;t<N.length;t++){const l=N[t];r.xj=Q.add(Number((n=r[l.statisticalDate])!=null?n:0),r.xj).toFixed(2)}r.rj=Q.divide(r.xj,N.length).toFixed(2)}J.value=a}function j(a){if(a.length<1){le(T);return}let n=a[0],r=[],t=[];a.forEach(l=>{l.merchantName==n.merchantName?t.push(l):r.push(l)}),T.push(t),j(r)}function le(a){if(a==[]||a==null)return;O=[];for(let c of a){for(var n=0;n<c.length-1;n++)for(var r=n+1;r<c.length;r++)c[n].transactionType===c[r].transactionType&&(c.splice(r,1),r--);O.push(c)}let t=O.map(function(c){return c.length});console.log(9999,t);let l=[];for(const c in O){let p=0;for(let f=0;f<c;f++)p=p+t[f];l[c]=p}m.value[0].children[0].customCell=(c,p)=>{for(const f in l)if(p==l[f])return{rowSpan:t[f],colSpan:1};return p===l[l.length-1]+t[t.length-1]+0?{colSpan:2}:{rowSpan:0,colSpan:0}},m.value[0].children[1].customCell=(c,p)=>{for(const f in l)if(p==l[f])return{rowSpan:t[f],colSpan:1};return p===l[l.length-1]+t[t.length-1]+0?{colSpan:0}:{rowSpan:0,colSpan:0}}}function se(a){if(a==[]||a==null)return;let n=JSON.parse(JSON.stringify(a));for(var r=0;r<n.length-1;r++)for(var t=r+1;t<n.length;t++)n[r].statisticalDate===n[t].statisticalDate&&(n.splice(t,1),t--);for(n.length>1&&(b(n[0].statisticalDate).isBefore(b(n[1].statisticalDate))||(n=n.reverse())),N.push(...n),A.value=N.length;m.value.length>1;)m.value.pop();for(const l of N){let c={title:l.statisticalDate,align:"center",children:[{title:"\u5B9E\u9645\u4EA4\u6613\u91D1\u989D",dataIndex:l.statisticalDate,key:l.statisticalDate,align:"center"}]};m.value.push(c)}m.value.push(...ee)}const ie=a=>{w.value.shopId=a=="0-0"?void 0:a,M()},ce=()=>{o.download("/maiquxinyu/paper/export",{...w.value},`daily_${new Date().getTime()}.xlsx`)};M();const q=()=>{Me().then(a=>{let n=a.data;Array.isArray(n)&&n.forEach(r=>{var t;r.shopName=`${r.shopName}(${(t=r.aliasName)!=null?t:""})`}),_.value=[{shopId:"0-0",shopName:"\u5168\u90E8",children:n}]})};q();function ue(a){let n=JSON.parse(JSON.stringify(_.value[0].children));if(a==""||a==null||a==null)q();else{let r=[];n.forEach(t=>{t.shopName.indexOf(a)>-1&&r.push(t)}),_.value=[{shopId:"0-0",shopName:"\u5168\u90E8",children:r}]}}return(a,n)=>{const r=Oe,t=Ie,l=Te,c=Fe,p=ye("c-icon"),f=Se,de=we,P=Re,pe=ze,fe=Ce,me=ke,he=be("hasPermi");return V(),$(P,{wrap:""},{default:u(()=>[i(t,{span:4},{default:u(()=>[i(r,{bordered:!1,class:"card",size:"small"},{default:u(()=>[i(Ee,{"shop-options":_.value,onSelect:ie,onSelClick:ue},null,8,["shop-options"])]),_:1})]),_:1}),i(t,{span:20},{default:u(()=>[i(r,{bordered:!1,class:"card card-search p-0",size:"small"},{default:u(()=>[i(pe,{class:"search-form",model:L(w),ref:"queryRef","label-col":{span:8},"wrapper-col":{span:16}},{default:u(()=>[i(P,{gutter:24},{default:u(()=>[i(t,{md:12,sm:24},{default:u(()=>[i(c,{label:"\u4EA4\u6613\u65F6\u95F4"},{default:u(()=>[i(l,{allowClear:"",style:{width:"100%"},value:L(S),"onUpdate:value":n[0]||(n[0]=D=>G(S)?S.value=D:null),placeholder:["\u5F00\u59CB\u65E5\u671F","\u7ED3\u675F\u65E5\u671F"],"disabled-date":W,onChange:ae,onOpenChange:te,onCalendarChange:ne},null,8,["value"])]),_:1})]),_:1}),i(t,{md:!d.value&&8||24,sm:24},{default:u(()=>[U("span",{style:xe(d.value&&{float:"right",overflow:"hidden"}||{})},[i(de,null,{default:u(()=>[i(f,{type:"primary",onClick:Y},{default:u(()=>[i(p,{type:"SearchOutlined"}),je]),_:1}),i(f,{onClick:re},{default:u(()=>[i(p,{type:"SyncOutlined"}),qe]),_:1})]),_:1})],4)]),_:1},8,["md"])]),_:1})]),_:1},8,["model"])]),_:1}),i(r,{bordered:!1,class:"card",size:"small"},{default:u(()=>[U("div",Pe,[Ne((V(),$(f,{class:"is-plain",type:"warn",onClick:ce},{default:u(()=>[i(p,{type:"CloudDownloadOutlined"}),Ve]),_:1})),[[he,["system:paper:export"]]]),i(fe,{class:"float-right",columns:L(m),"onUpdate:columns":n[1]||(n[1]=D=>G(m)?m.value=D:null),tableSize:s.value,"onUpdate:tableSize":n[2]||(n[2]=D=>s.value=D),"refresh-loading":g.value,onRefresh:M},null,8,["columns","tableSize","refresh-loading"])]),i(me,{loading:g.value,size:s.value,columns:L(m),"data-source":J.value,scroll:{x:120*A.value,y:1e3},pagination:!1,bordered:""},null,8,["loading","size","columns","data-source","scroll"])]),_:1})]),_:1})]),_:1})}}});export{ut as default};
